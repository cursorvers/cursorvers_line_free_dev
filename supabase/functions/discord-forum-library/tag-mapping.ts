// supabase/functions/discord-forum-library/tag-mapping.ts
// note.com ハッシュタグ → Discord Forum タグ マッピング

/** Discord Forum タグ定義（最大20個/チャンネル） */
export const FORUM_TAGS = [
  "医療AI基礎",
  "規制・コンプライアンス",
  "セキュリティ・個人情報",
  "業務効率化・省力化",
  "コスト・投資対効果",
  "医療の質・患者体験",
  "SaMD・医療機器",
  "データガバナンス",
  "診断・判断支援",
  "学習・教育",
  "創薬・研究",
  "AI実装・開発",
  "ヘルスケア・予防",
  "AI戦略・経営",
  "契約・法務",
  "テクノロジー動向",
  "国際動向",
  "キャリア・副業",
  "手術・治療支援",
  "画像解析",
] as const;

export type ForumTagName = (typeof FORUM_TAGS)[number];

/**
 * note.com ハッシュタグ → Forum タグ マッピング
 * キーは "#" なしのハッシュタグ名
 */
const HASHTAG_TO_FORUM_TAG: Record<string, ForumTagName> = {
  // 医療AI基礎
  "医療AI": "医療AI基礎",
  "AI": "医療AI基礎",
  "人工知能": "医療AI基礎",

  // 規制・コンプライアンス
  "AI倫理": "規制・コンプライアンス",
  "3省2ガイドライン": "規制・コンプライアンス",
  "医療AIガバナンス": "規制・コンプライアンス",
  "ガバナンス": "規制・コンプライアンス",
  "コンプライアンス": "規制・コンプライアンス",
  "医療法": "規制・コンプライアンス",

  // セキュリティ・個人情報
  "個人情報保護法": "セキュリティ・個人情報",
  "情報セキュリティ": "セキュリティ・個人情報",
  "サイバーセキュリティ": "セキュリティ・個人情報",
  "個人情報": "セキュリティ・個人情報",
  "セキュリティ": "セキュリティ・個人情報",

  // 業務効率化・省力化
  "医療DX": "業務効率化・省力化",
  "働き方改革": "業務効率化・省力化",
  "電子カルテ": "業務効率化・省力化",
  "業務効率化": "業務効率化・省力化",
  "自動化": "業務効率化・省力化",
  "DX": "業務効率化・省力化",

  // コスト・投資対効果
  "ROI": "コスト・投資対効果",
  "病院経営": "コスト・投資対効果",
  "医療経営": "コスト・投資対効果",
  "コスト": "コスト・投資対効果",

  // 医療の質・患者体験
  "患者中心医療": "医療の質・患者体験",
  "インフォームドコンセント": "医療の質・患者体験",
  "患者体験": "医療の質・患者体験",
  "医療安全": "医療の質・患者体験",

  // SaMD・医療機器
  "SaMD": "SaMD・医療機器",
  "薬機法": "SaMD・医療機器",
  "医療機器": "SaMD・医療機器",
  "プログラム医療機器": "SaMD・医療機器",
  "PMDA": "SaMD・医療機器",

  // データガバナンス
  "データガバナンス": "データガバナンス",
  "データ主権": "データガバナンス",
  "データ利活用": "データガバナンス",

  // 診断・判断支援
  "診断支援": "診断・判断支援",
  "診療支援": "診断・判断支援",
  "意思決定支援": "診断・判断支援",

  // 学習・教育
  "AIと学び": "学習・教育",
  "教育AI": "学習・教育",
  "リスキリング": "学習・教育",
  "医学教育": "学習・教育",

  // 創薬・研究
  "創薬AI": "創薬・研究",
  "臨床研究": "創薬・研究",
  "創薬": "創薬・研究",

  // AI実装・開発
  "生成AI": "AI実装・開発",
  "LLM": "AI実装・開発",
  "プロンプトエンジニアリング": "AI実装・開発",
  "ChatGPT": "AI実装・開発",
  "Claude": "AI実装・開発",
  "RAG": "AI実装・開発",

  // ヘルスケア・予防
  "ヘルスケア": "ヘルスケア・予防",
  "予防医療": "ヘルスケア・予防",
  "健康寿命": "ヘルスケア・予防",
  "PHR": "ヘルスケア・予防",

  // AI戦略・経営
  "経営戦略": "AI戦略・経営",
  "クリニック経営": "AI戦略・経営",
  "AI戦略": "AI戦略・経営",

  // 契約・法務
  "契約": "契約・法務",
  "リスクマネジメント": "契約・法務",
  "法務": "契約・法務",

  // テクノロジー動向
  "Google": "テクノロジー動向",
  "Microsoft": "テクノロジー動向",
  "OpenAI": "テクノロジー動向",
  "AWS": "テクノロジー動向",
  "Apple": "テクノロジー動向",

  // 国際動向
  "EUAIAct": "国際動向",
  "FDA": "国際動向",
  "経済安全保障": "国際動向",
  "WHO": "国際動向",

  // キャリア・副業
  "副業": "キャリア・副業",
  "AI副業": "キャリア・副業",
  "フリーランス": "キャリア・副業",
  "キャリア": "キャリア・副業",

  // 手術・治療支援
  "手術支援ロボット": "手術・治療支援",
  "フィジカルAI": "手術・治療支援",
  "ロボット手術": "手術・治療支援",

  // 画像解析
  "NanoBananaPro": "画像解析",
  "c2pa": "画像解析",
  "画像診断": "画像解析",
  "医用画像": "画像解析",
};

/**
 * note.com ハッシュタグ配列を Forum タグ配列に変換
 * 重複除去、最大5個/スレッド制限を適用
 */
export function mapHashtagsToForumTags(
  hashtags: readonly string[],
): string[] {
  const tagSet = new Set<string>();

  for (const raw of hashtags) {
    const cleaned = raw.replace(/^#/, "");
    const mapped = HASHTAG_TO_FORUM_TAG[cleaned];
    if (mapped) {
      tagSet.add(mapped);
    }
  }

  // Discord Forum: 最大5タグ/スレッド
  return [...tagSet].slice(0, 5);
}
